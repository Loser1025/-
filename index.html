<script>
    const transcribeBtn = document.getElementById('transcribe-btn');
    const audioFileInput = document.getElementById('audio-file');
    const resultDiv = document.getElementById('result');
    const loader = document.getElementById('loader');
    const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwD-rTjg10Kv-Qp9cTN-vVRUcNUqHmCVDqmHHLWszCUxn8DOibotCP_yHcg_1hfFzLy/exec";

    transcribeBtn.addEventListener('click', async () => {
        const audioFile = audioFileInput.files[0];
        if (!audioFile) {
            resultDiv.textContent = '音声ファイルを選択してください。';
            return;
        }
        transcribeBtn.disabled = true;
        loader.style.display = 'block';
        resultDiv.textContent = 'サーバーにファイルを送信中...';
        try {
            const response = await fetch(GAS_WEB_APP_URL, {
                method: 'POST',
                body: audioFile,
                headers: { 'Content-Type': audioFile.type }
            });
            resultDiv.textContent = '文字起こし処理中...';
            const data = await response.json();
            
            // ▼▼▼ 変更点 ▼▼▼
            // GASから返ってくる新しいデータ形式を確認します
            if (data.status === "success") {
              resultDiv.textContent = data.message + "\n\n" + data.transcript;
            } else if (data.status === "error") {
              throw new Error(data.error);
            } else {
              // もし古い形式のデータが返ってきた場合
              resultDiv.textContent = "GASの更新が反映されていません。古いデータが返されました。\n\n" + JSON.stringify(data);
            }
        } catch (error) {
            console.error('エラー:', error);
            resultDiv.textContent = `エラーが発生しました:\n${error.message}`;
        } finally {
            transcribeBtn.disabled = false;
            loader.style.display = 'none';
        }
    });
</script>
